# Netlify Configuration for yoohoo.guru Platform
#
# Note: This is a Node.js/Next.js Turborepo monorepo (NOT Nx).
# Python dependencies have been moved to python-mcp-server/ subdirectory
# to prevent Netlify from auto-detecting and attempting to install them.
#
# Build Tool: Turborepo (turbo)
# Monorepo Structure: npm workspaces
# Package Manager: npm

[build]
  # Explicitly set base to the repository root so Netlify resolves paths correctly.
  base = "/"

  # Build command for Turborepo monorepo - builds the main app by default.
  # Using npm install (not npm ci) ensures proper workspace dependency resolution.
  command = "npm install && npx turbo run build --filter=@yoohooguru/main"

  # Publish directory for the Next.js main app.
  publish = "apps/main/.next"

[build.environment]
  # Force Netlify to include devDependencies (TypeScript, ESLint, etc.)
  NODE_ENV = "development"
  NPM_FLAGS = "--include=dev"

  # Ensure consistent Node version (Use stable Node 20 LTS)
  NODE_VERSION = "20"

  # Enable Turborepo build caching
  TURBO_CACHE_DIR = ".turbo"

# Use the official Netlify Next.js runtime
[[plugins]]
  package = "@netlify/plugin-nextjs"
  [plugins.inputs]
    version = "14.2.0"

# Recommended Deployment Architecture
# ------------------------------------
# Each app can be deployed separately for isolation and scalability.
# Frontend (Next.js apps) → Vercel or Netlify
# Backend (Express/Firebase APIs) → Railway or Cloud Run
#
# Example commands for alternate apps:
# - Angel app:
#     command = "npm install && npx turbo run build --filter=@yoohooguru/angel"
#     publish = "apps/angel/.next"
# - Coach app:
#     command = "npm install && npx turbo run build --filter=@yoohooguru/coach"
#     publish = "apps/coach/.next"
# - Heroes app:
#     command = "npm install && npx turbo run build --filter=@yoohooguru/heroes"
#     publish = "apps/heroes/.next"
# - Dashboard app:
#     command = "npm install && npx turbo run build --filter=@yoohooguru/dashboard"
#     publish = "apps/dashboard/.next"
#
# See docs/DEPLOYMENT.md for details.
